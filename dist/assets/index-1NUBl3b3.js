var I=Object.defineProperty;var z=(h,t,e)=>t in h?I(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var s=(h,t,e)=>(z(h,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();const k={straight:[["straight"],["straight"],["straight"],["straight"]],square:[["square","square"],["square","square"]],tTetromino:[["tTetromino","tTetromino","tTetromino"],["","tTetromino",""]],lTetromino:[["lTetromino",""],["lTetromino",""],["lTetromino","lTetromino"]],skew:[["","skew","skew"],["skew","skew",""]],zTetromino:[["zTetromino","zTetromino",""],["","zTetromino","zTetromino"]],xTetromino:[["xTetromino","","xTetromino"],["","xTetromino",""],["xTetromino","","xTetromino"]],uTetromino:[["uTetromino","","uTetromino"],["uTetromino","","uTetromino"],["uTetromino","uTetromino","uTetromino"]],plusTetromino:[["","plusTetromino",""],["plusTetromino","plusTetromino","plusTetromino"],["","plusTetromino",""]],hammerTetromino:[["hammerTetromino","hammerTetromino","hammerTetromino"],["","hammerTetromino",""],["","hammerTetromino",""]]},T=Object.keys(k);class w{constructor(t){s(this,"x");s(this,"y");s(this,"game");s(this,"lastMoveDownTime",0);s(this,"isMoveEnd",!1);s(this,"keyState",{});s(this,"type",T[Math.floor(Math.random()*T.length)]);s(this,"shape",k[this.type]);this.game=t,this.x=Math.floor(this.game.boardSize-this.game.spaceWidth)/2,this.y=0,window.addEventListener("keydown",e=>{this.keyState[e.key]=!0}),window.addEventListener("keyup",e=>{this.keyState[e.key]=!1})}update(t,e){e-this.lastMoveDownTime>this.game.moveDownInterval&&(this.lastMoveDownTime=e,this.moveDown()),this.keyState.ArrowRight?(this.moveRight(),delete this.keyState.ArrowRight):this.keyState.ArrowLeft?(this.moveLeft(),delete this.keyState.ArrowLeft):this.keyState.ArrowUp?(this.rotate(),delete this.keyState.ArrowUp):this.keyState.ArrowDown&&(this.moveDown(1),delete this.keyState.ArrowDown)}moveDown(t=1){this.isNextMoveEmpty(this.x,this.y+t)?this.y+=t:this.isMoveEnd=!0}moveRight(t=1){this.isNextMoveEmpty(this.x+t,this.y)&&(this.x+=t)}moveLeft(t=1){this.isNextMoveEmpty(this.x-t,this.y)&&(this.x-=t)}rotate(){const t=[],e=this.shape,i=e.length,o=e[0].length;for(let n=0;n<o;n++){t[n]=[];for(let l=0;l<i;l++)t[n][l]=e[i-l-1][n]}const r=this.game.board[0].length-t[0].length,a=this.game.board.length-t.length;this.x>r||this.y>a||this.isNextMoveEmpty(this.x,this.y,t)&&(this.shape=t)}isNextMoveEmpty(t,e,i=this.shape){const o=i.length,r=i[0].length;if(t<0||t+r>this.game.board[0].length-this.game.spaceWidth||e+o>this.game.board.length)return!1;for(let a=0;a<o;a++)for(let n=0;n<r;n++)if(i[a][n]&&this.game.board[e+a][t+n])return!1;return!0}addTetrominoToMatrix(){for(let t=0;t<this.shape.length;t++)for(let e=0;e<this.shape[t].length;e++){const i=this.x+e,o=this.y+t;i>=0&&i<this.game.board[0].length&&o>=0&&o<this.game.board.length&&this.shape[t][e]!==""&&(this.game.board[o][i]=this.type)}}draw(t){const{x:e,y:i}=this;for(let o=0;o<this.shape.length;o++)for(let r=0;r<this.shape[o].length;r++){const a=this.shape[o][r];if(a){const n=this.game.getBlockColor(a);this.game.drawBlock(e+r,i+o,n)}}}}class D{constructor(t){s(this,"game");s(this,"fontFamily");s(this,"fontSize");this.game=t,this.fontSize=50,this.fontFamily="Helvetica"}getMaxWidth(t){let e=0;for(let i of t){let o=0;for(let r of i)r&&o++;o>e&&(e=o)}return e}draw(t){t.save();const e=this.game.canvas.width/this.game.boardSize,i=this.game.canvas.height/this.game.boardSize,o=(this.game.boardSize-this.game.spaceWidth)*e,r=this.game.canvas.width,a=t.measureText("Next");if(t.fillStyle="black",t.fillText("Next",o+(r-o)/2-a.width/2,i*4),t.fillStyle="black",t.font=this.fontSize*.7+"px "+this.fontFamily,t.textAlign="left",this.game.nextTetromino){const d=this.game.nextTetromino.shape,E=d[0].length,g=this.game.spaceWidth,L=this.game.boardSize-g+Math.floor((g-E)/2);for(let m=0;m<d.length;m++)for(let f=0;f<d[m].length;f++){const u=d[m][f];if(u){const B=this.game.getBlockColor(u);this.game.drawBlock(L+f,6+m,B)}}}const n=t.measureText("Score");t.fillStyle="black",t.fillText("Score",o+(r-o)/2-n.width/2,13*i);const l=t.measureText(""+this.game.points);t.fillText(""+this.game.points,o+(r-o)/2-l.width/2,15*i);const S=t.measureText("Level");t.fillText("Level",o+(r-o)/2-S.width/2,21*i),t.fillStyle="black";const M=t.measureText(""+this.game.points);t.fillText(""+this.game.level,o+(r-o)/2-M.width/2,23*i)}}class p{constructor(t,e){s(this,"isGameOver",!1);s(this,"points",0);s(this,"boardSize");s(this,"spaceWidth",8);s(this,"level",1);s(this,"time",0);s(this,"moveDownInterval",700);s(this,"board",[]);s(this,"currentTetromino",null);s(this,"nextTetromino",null);s(this,"canvas");s(this,"ctx");s(this,"UI");this.canvas=t,this.canvas.width=600,this.canvas.height=600,this.ctx=t.getContext("2d"),this.UI=new D(this),this.boardSize=e,this.initBoard(),this.addTetromino()}initBoard(){for(let t=0;t<this.boardSize;t++){this.board[t]=[];for(let e=0;e<this.boardSize;e++)this.board[t][e]=""}}addTetromino(){this.currentTetromino=this.nextTetromino||new w(this),this.nextTetromino=new w(this)}update(t,e){var i,o;this.time+=t,(i=this.currentTetromino)==null||i.update(t,e),(o=this.currentTetromino)!=null&&o.isMoveEnd&&(this.currentTetromino.addTetrominoToMatrix(),this.checkAndClearFullRows(),this.addTetromino(),this.currentTetromino.isNextMoveEmpty(this.currentTetromino.x,this.currentTetromino.y)||(this.isGameOver=!0))}draw(){var t;this.drawBoard(),(t=this.currentTetromino)==null||t.draw(this.ctx),this.UI.draw(this.ctx)}checkAndClearFullRows(){for(let t=this.board.length-1;t>=0;t--)this.isRowFull(t)&&(this.clearRow(t),this.moveRowsDown(t),t++,this.points+=10,this.points&&this.points%100===0&&(this.level+=1,this.moveDownInterval>50&&(this.moveDownInterval-=20)))}isRowFull(t){let e=!0;for(let i=0;i<this.board[t].length-this.spaceWidth;i++)this.board[t][i]===""&&(e=!1);return e}clearRow(t){for(let e=0;e<this.board[t].length;e++)this.board[t][e]=""}moveRowsDown(t){for(let e=t-1;e>=0;e--)for(let i=0;i<this.board[e].length;i++)this.board[e+1][i]=this.board[e][i];this.board[0].fill("")}drawBlock(t,e,i,o="white"){const r=this.canvas.width/this.boardSize,a=this.canvas.height/this.boardSize;this.ctx.fillStyle=i,this.ctx.fillRect(t*r,e*a,r,a),this.ctx.strokeStyle=o,this.ctx.strokeRect(t*r,e*a,r,a)}drawBoard(){for(let t=0;t<this.board.length;t++)for(let e=0;e<this.board[0].length;e++){const i=e>=0&&e<this.board[0].length-this.spaceWidth;if(i)if(this.board[t][e]){const o=this.getBlockColor(this.board[t][e]);this.drawBlock(e,t,o)}else this.drawBlock(e,t,"lightgray");else i||this.drawBlock(e,t,"lightgray","lightgray")}}getBlockColor(t){return{straight:"blue",square:"red",tTetromino:"green",lTetromino:"black",skew:"orange",zTetromino:"purple",xTetromino:"yellow",uTetromino:"cyan",plusTetromino:"#5d6f1a",hammerTetromino:"brown"}[t]||"lightgray"}getRandomColor(){const t=Math.floor(Math.random()*256),e=Math.floor(Math.random()*256),i=Math.floor(Math.random()*256);return"rgb("+t+", "+e+", "+i+")"}}function c(h=25){const t=document.getElementById("canvas");let e=new p(t,h),i=0;function o(r){const a=r-i;i=r,e.update(a,r),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.draw(),e.isGameOver&&(e=new p(t,h),i=0),requestAnimationFrame(o)}o(0)}c(40);var y;(y=document.querySelector(".mat-20"))==null||y.addEventListener("click",()=>{c(20)});var v;(v=document.querySelector(".mat-30"))==null||v.addEventListener("click",()=>{c(30)});var b;(b=document.querySelector(".mat-40"))==null||b.addEventListener("click",()=>{c(40)});var x;(x=document.querySelector(".mat-50"))==null||x.addEventListener("click",()=>{c(50)});
