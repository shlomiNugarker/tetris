var I=Object.defineProperty;var D=(n,t,e)=>t in n?I(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(D(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const S={straight:[["straight"],["straight"],["straight"],["straight"]],square:[["square","square"],["square","square"]],tTetromino:[["tTetromino","tTetromino","tTetromino"],["","tTetromino",""]],lTetromino:[["lTetromino",""],["lTetromino",""],["lTetromino","lTetromino"]],skew:[["","skew","skew"],["skew","skew",""]]},w=Object.keys(S);class y{constructor(t){r(this,"x");r(this,"y");r(this,"game");r(this,"lastMoveDownTime",0);r(this,"isMoveEnd",!1);r(this,"keyState",{});r(this,"type",w[Math.floor(Math.random()*w.length)]);r(this,"shape",S[this.type]);this.game=t,this.x=Math.floor(this.game.boardSize-this.game.spaceWidth)/2,this.y=0,window.addEventListener("keydown",e=>{this.keyState[e.key]=!0}),window.addEventListener("keyup",e=>{this.keyState[e.key]=!1})}update(t,e){e-this.lastMoveDownTime>this.game.moveDownInterval&&(this.lastMoveDownTime=e,this.moveDown()),this.keyState.ArrowRight?(this.moveRight(),delete this.keyState.ArrowRight):this.keyState.ArrowLeft?(this.moveLeft(),delete this.keyState.ArrowLeft):this.keyState.ArrowUp?(this.rotate(),delete this.keyState.ArrowUp):this.keyState.ArrowDown&&(this.moveDown(1),delete this.keyState.ArrowDown)}moveDown(t=1){this.isNextMoveEmpty(this.x,this.y+t)?this.y+=t:this.isMoveEnd=!0}moveRight(t=1){this.isNextMoveEmpty(this.x+t,this.y)&&(this.x+=t)}moveLeft(t=1){this.isNextMoveEmpty(this.x-t,this.y)&&(this.x-=t)}rotate(){const t=[],e=this.shape,o=e.length,i=e[0].length;for(let h=0;h<i;h++){t[h]=[];for(let l=0;l<o;l++)t[h][l]=e[o-l-1][h]}const s=this.game.board[0].length-t[0].length,a=this.game.board.length-t.length;this.x>s||this.y>a||this.isNextMoveEmpty(this.x,this.y,t)&&(this.shape=t)}isNextMoveEmpty(t,e,o=this.shape){const i=o.length,s=o[0].length;if(t<0||t+s>this.game.board[0].length-this.game.spaceWidth||e+i>this.game.board.length)return!1;for(let a=0;a<i;a++)for(let h=0;h<s;h++)if(o[a][h]&&this.game.board[e+a][t+h])return!1;return!0}addTetrominoToMatrix(){for(let t=0;t<this.shape.length;t++)for(let e=0;e<this.shape[t].length;e++){const o=this.x+e,i=this.y+t;o>=0&&o<this.game.board[0].length&&i>=0&&i<this.game.board.length&&this.shape[t][e]!==""&&(this.game.board[i][o]=this.type)}}draw(t){const{x:e,y:o}=this;for(let i=0;i<this.shape.length;i++)for(let s=0;s<this.shape[i].length;s++){const a=this.shape[i][s];if(a){const h=this.game.getBlockColor(a);this.game.drawBlock(e+s,o+i,h)}}}}class R{constructor(t){r(this,"game");r(this,"fontFamily");r(this,"fontSize");this.game=t,this.fontSize=25,this.fontFamily="Helvetica"}getMaxWidth(t){let e=0;for(let o of t){let i=0;for(let s of o)s&&i++;i>e&&(e=i)}return e}draw(t){t.save();const e=this.game.canvas.width/this.game.boardSize,o=this.game.canvas.height/this.game.boardSize,i=(this.game.boardSize-this.game.spaceWidth)*e,s=this.game.canvas.width,a=t.measureText("Next");if(t.fillStyle="black",t.fillText("Next",i+(s-i)/2-a.width/2,o*4),t.fillStyle="black",t.font=this.fontSize*.7+"px "+this.fontFamily,t.textAlign="left",this.game.nextTetromino){const m=this.game.nextTetromino.shape,E=m[0].length,g=this.game.spaceWidth,L=this.game.boardSize-g+Math.floor((g-E)/2);for(let c=0;c<m.length;c++)for(let f=0;f<m[c].length;f++){const u=m[c][f];if(u){const B=this.game.getBlockColor(u);this.game.drawBlock(L+f,6+c,B)}}}const h=t.measureText("Score");t.fillStyle="black",t.fillText("Score",i+(s-i)/2-h.width/2,13*o);const l=t.measureText(""+this.game.points);t.fillText(""+this.game.points,i+(s-i)/2-l.width/2,15*o);const x=t.measureText("Level");t.fillText("Level",i+(s-i)/2-x.width/2,21*o),t.fillStyle="black";const M=t.measureText(""+this.game.points);t.fillText(""+this.game.level,i+(s-i)/2-M.width/2,23*o)}}class p{constructor(t,e){r(this,"isGameOver",!1);r(this,"points",0);r(this,"boardSize");r(this,"spaceWidth",8);r(this,"level",1);r(this,"time",0);r(this,"moveDownInterval",700);r(this,"board",[]);r(this,"currentTetromino",null);r(this,"nextTetromino",null);r(this,"canvas");r(this,"ctx");r(this,"UI");this.canvas=t,this.canvas.width=400,this.canvas.height=400,this.ctx=t.getContext("2d"),this.UI=new R(this),this.boardSize=e,this.initBoard(),this.addTetromino()}initBoard(){for(let t=0;t<this.boardSize;t++){this.board[t]=[];for(let e=0;e<this.boardSize;e++)this.board[t][e]=""}}addTetromino(){this.currentTetromino=this.nextTetromino||new y(this),this.nextTetromino=new y(this)}update(t,e){var o,i;this.time+=t,(o=this.currentTetromino)==null||o.update(t,e),(i=this.currentTetromino)!=null&&i.isMoveEnd&&(this.currentTetromino.addTetrominoToMatrix(),this.checkAndClearFullRows(),this.addTetromino(),this.currentTetromino.isNextMoveEmpty(this.currentTetromino.x,this.currentTetromino.y)||(this.isGameOver=!0))}draw(){var t;this.drawBoard(),(t=this.currentTetromino)==null||t.draw(this.ctx),this.UI.draw(this.ctx)}checkAndClearFullRows(){for(let t=this.board.length-1;t>=0;t--)this.isRowFull(t)&&(this.clearRow(t),this.moveRowsDown(t),t++,this.points+=10,this.points&&this.points%100===0&&(this.level+=1,this.moveDownInterval>50&&(this.moveDownInterval-=20)))}isRowFull(t){let e=!0;for(let o=0;o<this.board[t].length-this.spaceWidth;o++)this.board[t][o]===""&&(e=!1);return e}clearRow(t){for(let e=0;e<this.board[t].length;e++)this.board[t][e]=""}moveRowsDown(t){for(let e=t-1;e>=0;e--)for(let o=0;o<this.board[e].length;o++)this.board[e+1][o]=this.board[e][o];this.board[0].fill("")}drawBlock(t,e,o,i="white"){const s=this.canvas.width/this.boardSize,a=this.canvas.height/this.boardSize;this.ctx.fillStyle=o,this.ctx.fillRect(t*s,e*a,s,a),this.ctx.strokeStyle=i,this.ctx.strokeRect(t*s,e*a,s,a)}drawBoard(){for(let t=0;t<this.board.length;t++)for(let e=0;e<this.board[0].length;e++){const o=e>=0&&e<this.board[0].length-this.spaceWidth;if(o)if(this.board[t][e]){const i=this.getBlockColor(this.board[t][e]);this.drawBlock(e,t,i)}else this.drawBlock(e,t,"lightgray");else o||this.drawBlock(e,t,"lightgray","lightgray")}}getBlockColor(t){return{straight:"blue",square:"red",tTetromino:"green",lTetromino:"black",skew:"orange",zTetromino:"purple",xTetromino:"yellow",uTetromino:"cyan",plusTetromino:"#5d6f1a",hammerTetromino:"brown"}[t]||"lightgray"}getRandomColor(){const t=Math.floor(Math.random()*256),e=Math.floor(Math.random()*256),o=Math.floor(Math.random()*256);return"rgb("+t+", "+e+", "+o+")"}}function d(n=25){const t=document.getElementById("canvas");let e=new p(t,n),o=0;function i(s){const a=s-o;o=s,e.update(a,s),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.draw(),e.isGameOver&&(e=new p(t,n),o=0),requestAnimationFrame(i)}i(0)}d(40);var v;(v=document.querySelector(".mat-20"))==null||v.addEventListener("click",()=>{d(20)});var T;(T=document.querySelector(".mat-30"))==null||T.addEventListener("click",()=>{d(30)});var b;(b=document.querySelector(".mat-40"))==null||b.addEventListener("click",()=>{d(40)});var k;(k=document.querySelector(".mat-50"))==null||k.addEventListener("click",()=>{d(50)});
